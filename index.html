<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>BLE Browser</title>
<style>
    body {
        font-family: sans-serif;
        margin: 2rem;
    }
    button {
        padding: 0.6rem 1rem;
        font-size: 1.1rem;
    }
    select {
        padding: 0.4rem;
        margin-left: 1rem;
    }
    .hidden { display: none; }
</style>
</head>
<body>

<h2>BLE Device Scanner</h2>

<button id="connectBtn">Connect to BLE Device</button>
<select id="serviceSelect" class="hidden"></select>

<pre id="log"></pre>

<script>
const log = msg => {
    document.getElementById("log").textContent += msg + "\n";
};

let bleDevice = null;
let gattServer = null;

document.getElementById("connectBtn").addEventListener("click", async () => {
    try {
        log("Requesting BLE device...");
        bleDevice = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: []   // we will discover dynamically
        });

        log("Connecting to GATT...");
        gattServer = await bleDevice.gatt.connect();

        log("Connected. Discovering primary services...");
        const services = await gattServer.getPrimaryServices();

        const serviceSelect = document.getElementById("serviceSelect");
        serviceSelect.innerHTML = "";  // clear
        serviceSelect.classList.remove("hidden");

        services.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.uuid;
            opt.textContent = s.uuid;
            serviceSelect.appendChild(opt);
        });

        log("Select a service from the dropdown above.");
    } 
    catch (err) {
        log("Error: " + err);
    }
});


document.getElementById("serviceSelect").addEventListener("change", async (e) => {
    const uuid = e.target.value;
    log("Getting service: " + uuid);

    try {
        const service = await gattServer.getPrimaryService(uuid);
        const chars = await service.getCharacteristics();

        log("\nCharacteristics of " + uuid + ":");
        chars.forEach(c => log(" - " + c.uuid));
    } 
    catch (err) {
        log("Error reading service: " + err);
    }
});
</script>

</body>
</html>
